# Taskfile vs. Make: パフォーマンスと使いやすさの比較

## 概要

このリポジトリは、ビルドツールである Task の利点を紹介することを目的としています。
特に、伝統的な `make` コマンドと比較して、`Task` が開発ワークフローにおいてどれだけ優れているか、
具体的には実行速度の向上や人的コスト（学習コスト、メンテナンスコスト）の削減にどの程度貢献するのかを実証するために作成されました。

## このリポジトリが想定するアプリケーション

このプロジェクトは、架空の多機能Webサービスをシミュレートしています。E2Eテストは、以下のような複雑なシナリオを想定して作成されています。

- **ユーザー管理:** 一般的なユーザー登録、ログイン、情報更新機能。
- **プレミアム会員機能:** 通常会員とは異なる特典を持つプレミアム会員向けの機能。
- **不正検知・対策:** 不正なログイン試行やボットによるアクセスなど、セキュリティ上の脅威を検知・ブロックするシナリオ。
- **エラーハンドリング:** 予期せぬ入力や境界値に対するシステムの堅牢性をテストするシナリオ。

これらのシナリオを通じて、単純なタスク実行だけでなく、現実の複雑なアプリケーション開発において`Task`がどのように貢献できるかを示します。

## 目的

`make` と `Task` の両方を使用して同じ一連のタスク（ビルド、テスト、デプロイなど）を実行し、以下の観点から比較・評価します。

- **実行速度:** 各タスクの完了までにかかる時間。
- **人的コスト:**
  - **可読性とメンテナンス性:** `Taskfile.yml` (YAML) と `Makefile` の記述のしやすさ、読みやすさ。
  - **学習コスト:** 新しい開発者がプロジェクトに参加した際の学習のしやすさ。
  - **機能性:** 依存関係の管理、クロスプラットフォーム対応など。

## 実行方法（パフォーマンス比較手順）

ローカル環境で`make`と`Task`の実行速度を比較するための手順は以下の通りです。

### 1. 前提条件

- Docker と Docker Compose
- `Go (v1.24以上)
- `make`
- `task` (インストールされていない場合はプレゼン資料をみてインストールしてください)

### 2. セットアップ

```bash
# 1. リポジトリをクローン
git clone https://github.com/ageha734/dmm-go-2025-09-17-go-task.git
cd dmm-go-2025-09-17-go-task
```

```bash
# 2. 環境変数の設定
cp .env.example .env
```

```bash
# 3. 環境変数をGitHub Secretsに登録
./scripts/sync_env_to_github_secrets.sh
```

```bash
# 4. 必要なCLIツールをインストール
task setup
```

```bash
# 5. データベースとAPIサーバーを起動
docker compose up -d
```

### 3. パフォーマンス比較の実行

いくつかの比較用スクリプトが用意されています。

#### **E2Eテストの速度を比較する**

特定のサービス（例: `user`）または全サービスのE2Eテスト実行時間を比較します。

```bash
# 全サービスのE2Eテストを比較
./scripts/e2e_speed_check.sh
```

```bash
# 'user' サービスのE2Eテストのみ比較
./scripts/e2e_speed_check.sh user
```

#### **特定のタスク（ビルド、リントなど）の速度を比較する**

`build`や`lint`など、個別のタスクの実行時間を比較します。

```bash
# ビルドタスクの実行時間を比較
./scripts/compare_speed_check.sh build
```

```bash
# ユニットテストの実行時間を比較
./scripts/compare_speed_check.sh unit
```

## 実行結果の例（参考値）

以下は、開発環境（MacBook Pro, M4 Pro）で各比較スクリプトを実行した際の結果の一例です。
**注意:** E2Eテストは現状不安定なため、これらの数値はあくまで参考値としてご覧ください。環境や実行タイミングによって結果は変動します。

### E2Eテスト (`./scripts/e2e_speed_check.sh`)

全サービスのE2Eテストを実行した場合の比較です。

#### 1回目の実行（E2Eテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `15.353s`       |
| `task`   | `12.764s`       |
| **差**   | **`task`が約%高速** |

#### 2回目の実行（E2Eテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `15.214s`       |
| `task`   | `07.589s`       |
| **差**   | **`task`が約%高速** |

### ユニットテスト (`./scripts/compare_speed_check.sh unit`)

ユニットテストのみを実行した場合の比較です。

#### 1回目の実行（ユニットテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `07.222s`       |
| `task`   | `05.189s`       |
| **差**   | **`task`が約%高速** |

#### 2回目の実行（ユニットテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `05.114s`       |
| `task`   | `01.501s`        |
| **差**   | **`task`が約%高速** |

これらの結果から、特に複数のタスクが連携するE2Eテストのような複雑なケースにおいて、
`Task`の依存関係解決や実行効率の良さが速度面でのアドバンテージに繋がる可能性が示唆されます。

## 現状と課題

現在、リポジトリ内のタスクは意図的に複雑に構成されています。
これは、より現実的なプロジェクトに近い状況で比較を行うためです。

しかし、特にEnd-to-End (E2E) テスト周りの実装が複雑であるため、
実行時にエラーが頻発しており、現時点ではパフォーマンスに関する正確な比較数値を安定して出力できていない状況です。

今後の課題として、E2Eテストの安定化を図り、信頼性の高いベンチマークデータを取得することを目指しています。
