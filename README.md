# Taskfile vs. Make: パフォーマンスと使いやすさの比較

## 概要

このリポジトリは、ビルドツールである Task の利点を紹介することを目的としています。
特に、伝統的な `make` コマンドと比較して、`Task` が開発ワークフローにおいてどれだけ優れているか、
具体的には実行速度の向上や人的コスト（学習コスト、メンテナンスコスト）の削減にどの程度貢献するのかを実証するために作成されました。

## このリポジトリが想定するアプリケーション

このプロジェクトは、架空の多機能Webサービスをシミュレートしています。E2Eテストは、以下のような複雑なシナリオを想定して作成されています。

- **ユーザー管理:** 一般的なユーザー登録、ログイン、情報更新機能。
- **プレミアム会員機能:** 通常会員とは異なる特典を持つプレミアム会員向けの機能。
- **不正検知・対策:** 不正なログイン試行やボットによるアクセスなど、セキュリティ上の脅威を検知・ブロックするシナリオ。
- **エラーハンドリング:** 予期せぬ入力や境界値に対するシステムの堅牢性をテストするシナリオ。

これらのシナリオを通じて、単純なタスク実行だけでなく、現実の複雑なアプリケーション開発において`Task`がどのように貢献できるかを示します。

## 目的

`make` と `Task` の両方を使用して同じ一連のタスク（ビルド、テスト、デプロイなど）を実行し、以下の観点から比較・評価します。

- **実行速度:** 各タスクの完了までにかかる時間。
- **人的コスト:**
  - **可読性とメンテナンス性:** `Taskfile.yml` (YAML) と `Makefile` の記述のしやすさ、読みやすさ。
  - **学習コスト:** 新しい開発者がプロジェクトに参加した際の学習のしやすさ。
  - **機能性:** 依存関係の管理、クロスプラットフォーム対応など。

## 実行方法（パフォーマンス比較手順）

ローカル環境で`make`と`Task`の実行速度を比較するための手順は以下の通りです。

### 1. 前提条件

- Docker と Docker Compose
- `Go (v1.24以上)
- `make`
- `task` (インストールされていない場合はプレゼン資料をみてインストールしてください)

### 2. セットアップ

⚠️ フォークしてから検証してください。

#### 1. リポジトリをクローン

```bash
git clone https://github.com/ageha734/dmm-go-2025-09-17-go-task.git
cd dmm-go-2025-09-17-go-task
```

#### 2. 環境変数の設定

```bash
# .envファイルを初期化
cp .env.template .env
```

```bash
# JWT_SECRETを自動生成して.envファイルに設定
go run scripts/generate-jwt-secret/main.go -update-env
```

#### 3. 環境変数をGitHub Secretsに登録

```bash
./scripts/sync_env_to_github_secrets.sh
```

#### 4. CLIツールをインストール

```bash
task setup
```

#### 5. ビルドする

```bash
# 5a. ローカルでDockerイメージをビルド
./scripts/local-docker-setup.sh --mode build
```

```bash
# 5b. GitHub Container Registryからイメージをプル（事前にプッシュが必要）
./scripts/local-docker-setup.sh --mode pull -p <token>
```

```bash
# 5c. 現在の設定を確認
./scripts/local-docker-setup.sh --mode status
```

#### 6. APIサーバーを起動

```bash
docker compose up -d
```

### 3. パフォーマンス比較の実行

いくつかの比較用スクリプトが用意されています。

#### **E2Eテストの速度を比較する**

特定のサービス（例: `user`）または全サービスのE2Eテスト実行時間を比較します。

```bash
# 全サービスのE2Eテストを比較
./scripts/e2e_speed_check.sh
```

```bash
# 'user' サービスのE2Eテストのみ比較
./scripts/e2e_speed_check.sh user
```

#### **特定のタスク（ビルド、リントなど）の速度を比較する**

`build`や`lint`など、個別のタスクの実行時間を比較します。

```bash
# ビルドタスクの実行時間を比較
./scripts/compare_speed_check.sh build
```

```bash
# ユニットテストの実行時間を比較
./scripts/compare_speed_check.sh unit
```

### 🤖 自動化（GitHub Actions）

#### 自動実行スケジュール

- **毎日10時・19時**: パフォーマンス結果の自動更新 (`update-performance-results.yaml`)
- **毎週月曜日**: 包括的比較レポートの生成 (`comprehensive-comparison.yaml`)

#### 手動実行

GitHub Actionsページから以下のワークフローを手動実行できます：

1. **Update Performance Results** - READMEの結果表を更新
2. **Comprehensive Make vs Task Comparison** - 詳細な比較レポートを生成

#### 自動更新される内容

- READMEのパフォーマンス比較表
- 実行時間の測定結果
- 最終更新日時
- Artifactsとして詳細レポートをダウンロード可能

### 📈 比較項目

| 項目 | 説明 | 測定方法 |
|------|------|----------|
| **実行時間** | タスクの完了までの時間 | `time` コマンド |
| **メモリ使用量** | 最大メモリ消費量（KB） | `ps` コマンド監視 |
| **CPU使用率** | 最大CPU使用率（%） | `ps` コマンド監視 |
| **複雑性** | 設定ファイルの複雑さ | 行数、ターゲット数、特殊構文 |
| **学習コスト** | 新規参加者の学習しやすさ | 構文の複雑性分析 |

### 🎯 使い分けガイド

| 用途 | 推奨ツール | 実行時間 |
|------|------------|----------|
| **クイック確認** | `quick_comparison.sh` | ~30秒 |
| **詳細分析** | `comprehensive_comparison.sh --all --report` | ~5分 |
| **E2Eテスト専用** | `e2e_speed_check.sh` | ~2分 |
| **CI/CD統合** | GitHub Actionsワークフロー | 自動 |
| **特定タスク詳細** | `compare_speed_check.sh` | ~1分 |

### 📋 レポート出力形式

包括的比較ツールは以下の形式でデータを出力します：

- **コンソール出力**: リアルタイム結果表示
- **CSV形式**: 数値データ（パフォーマンス測定結果）
- **Markdown形式**: 詳細な分析レポート
- **GitHub Actions Artifacts**: ダウンロード可能なレポートファイル

### 🚀 クイックスタート

初回セットアップ後、すぐに比較を開始できます：

```bash
# 1. 環境セットアップ（初回のみ）
cp .env.template .env
go run scripts/generate-jwt-secret/main.go -update-env
task setup

# 2. クイック比較を実行
./scripts/quick_comparison.sh

# 3. 詳細レポートを生成
./scripts/comprehensive_comparison.sh --all --report
```

## 実行結果の例（参考値）

**最終更新:** 2025年10月05日 02:29 JST


**最終更新:** 2025年10月04日 10:14 JST


**最終更新:** 2025年10月04日 02:14 JST


**最終更新:** 2025年10月03日 10:16 JST


**最終更新:** 2025年10月03日 02:18 JST


**最終更新:** 2025年10月02日 10:16 JST


**最終更新:** 2025年10月02日 02:19 JST


**最終更新:** 2025年10月01日 10:17 JST


**最終更新:** 2025年10月01日 02:31 JST


**最終更新:** 2025年09月30日 10:17 JST


**最終更新:** 2025年09月30日 02:19 JST


**最終更新:** 2025年09月29日 10:17 JST


**最終更新:** 2025年09月29日 02:25 JST


**最終更新:** 2025年09月28日 10:14 JST


**最終更新:** 2025年09月28日 02:29 JST


**最終更新:** 2025年09月27日 10:14 JST


**最終更新:** 2025年09月27日 02:16 JST


**最終更新:** 2025年09月26日 10:16 JST


**最終更新:** 2025年09月26日 02:22 JST


**最終更新:** 2025年09月25日 10:17 JST


**最終更新:** 2025年09月24日 10:16 JST


**最終更新:** 2025年09月24日 02:21 JST


**最終更新:** 2025年09月23日 10:16 JST


**最終更新:** 2025年09月23日 02:19 JST


**最終更新:** 2025年09月22日 10:17 JST


**最終更新:** 2025年09月22日 02:28 JST


**最終更新:** 2025年09月21日 10:15 JST


**最終更新:** 2025年09月21日 02:29 JST


**最終更新:** 2025年09月20日 10:15 JST


**最終更新:** 2025年09月20日 02:16 JST


**最終更新:** 2025年09月19日 10:17 JST


**最終更新:** 2025年09月19日 02:23 JST


**最終更新:** 2025年09月18日 10:16 JST


**最終更新:** 2025年09月18日 02:19 JST


**最終更新:** 2025年09月17日 10:16 JST


**最終更新:** 2025年09月17日 02:19 JST


**最終更新:** 2025年09月16日 10:16 JST


**最終更新:** 2025年09月16日 02:19 JST


**最終更新:** 2025年09月15日 10:17 JST


**最終更新:** 2025年09月15日 02:27 JST


**最終更新:** 2025年09月14日 10:14 JST


**最終更新:** 2025年09月14日 02:24 JST


**最終更新:** 2025年09月13日 10:13 JST


**最終更新:** 2025年09月13日 02:11 JST


**最終更新:** 2025年09月12日 10:16 JST


**最終更新:** 2025年09月12日 02:17 JST


**最終更新:** 2025年09月11日 10:15 JST


**最終更新:** 2025年09月11日 02:22 JST


**最終更新:** 2025年09月10日 10:15 JST


**最終更新:** 2025年09月10日 02:17 JST


**最終更新:** 2025年09月09日 10:17 JST


**最終更新:** 2025年09月09日 02:23 JST


**最終更新:** 2025年09月08日 10:17 JST


**最終更新:** 2025年09月08日 02:27 JST


**最終更新:** 2025年09月07日 10:14 JST


**最終更新:** 2025年09月07日 02:25 JST


**最終更新:** 2025年09月06日 10:14 JST


**最終更新:** 2025年09月06日 02:17 JST


**最終更新:** 2025年09月05日 10:17 JST


**最終更新:** 2025年09月05日 02:21 JST


**最終更新:** 2025年09月04日 10:16 JST


**最終更新:** 2025年09月04日 02:18 JST


**最終更新:** 2025年09月03日 10:16 JST


**最終更新:** 2025年09月03日 02:18 JST


**最終更新:** 2025年09月02日 10:17 JST


**最終更新:** 2025年09月02日 02:27 JST


**最終更新:** 2025年09月01日 10:17 JST


**最終更新:** 2025年09月01日 02:50 JST


**最終更新:** 2025年08月31日 10:14 JST


**最終更新:** 2025年08月31日 02:28 JST


**最終更新:** 2025年08月30日 10:14 JST


**最終更新:** 2025年08月30日 02:18 JST


**最終更新:** 2025年08月29日 10:16 JST


**最終更新:** 2025年08月29日 02:24 JST


**最終更新:** 2025年08月28日 10:16 JST


**最終更新:** 2025年08月28日 02:24 JST


**最終更新:** 2025年08月27日 21:32 JST


以下は、開発環境（MacBook Pro, M4 Pro）で各比較スクリプトを実行した際の結果の一例です。
**注意:** E2Eテストは現状不安定なため、これらの数値はあくまで参考値としてご覧ください。環境や実行タイミングによって結果は変動します。

### E2Eテスト (`./scripts/e2e_speed_check.sh`)

全サービスのE2Eテストを実行した場合の比較です。

#### 1回目の実行（E2Eテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `15.353s`       |
| `task`   | `12.764s`       |
| **差**   | **`task`が約%高速** |

#### 2回目の実行（E2Eテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `15.214s`       |
| `task`   | `07.589s`       |
| **差**   | **`task`が約%高速** |

### ユニットテスト (`./scripts/compare_speed_check.sh unit`)

ユニットテストのみを実行した場合の比較です。

#### 1回目の実行（ユニットテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `07.222s`       |
| `task`   | `05.189s`       |
| **差**   | **`task`が約%高速** |

#### 2回目の実行（ユニットテスト）

| ツール   | 実行時間 (real) |
| :------- | :-------------- |
| `make`   | `05.114s`       |
| `task`   | `01.501s`        |
| **差**   | **`task`が約%高速** |

これらの結果から、特に複数のタスクが連携するE2Eテストのような複雑なケースにおいて、
`Task`の依存関係解決や実行効率の良さが速度面でのアドバンテージに繋がる可能性が示唆されます。

## 現状と課題

現在、リポジトリ内のタスクは意図的に複雑に構成されています。
これは、より現実的なプロジェクトに近い状況で比較を行うためです。

しかし、特にEnd-to-End (E2E) テスト周りの実装が複雑であるため、
実行時にエラーが頻発しており、現時点ではパフォーマンスに関する正確な比較数値を安定して出力できていない状況です。

今後の課題として、E2Eテストの安定化を図り、信頼性の高いベンチマークデータを取得することを目指しています。
